<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Корзина | Лисёнок Маркет</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    :root {
      --primary: #6a11cb;
      --secondary: #2575fc;
      --light: #f8f9ff;
      --text: #2c3e50;
      --text-light: #7f8c8d;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', sans-serif;
    }

    body {
      background: var(--light);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 30px rgba(106, 17, 203, 0.1);
      padding: 15px 0;
    }

    .container {
      width: 90%;
      max-width: 1200px;
      margin: 0 auto;
    }

    .logo a {
      font-size: 1.5rem;
      font-weight: 700;
      text-decoration: none;
      color: var(--text);
      display: flex;
      align-items: center;
    }

    .logo a i {
      margin-right: 10px;
    }

    .logo span {
      background: linear-gradient(45deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .user-actions {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .user-actions a {
      color: var(--text);
      text-decoration: none;
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .header .container {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    /* Стили для страницы корзины */
    .cart-page {
      flex: 1;
      padding: 40px 0;
    }

    .page-title {
      text-align: center;
      margin-bottom: 30px;
      font-size: 2rem;
      color: var(--text);
      position: relative;
      padding-bottom: 15px;
    }

    .page-title::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
      height: 4px;
      background: linear-gradient(45deg, var(--primary), var(--secondary));
      border-radius: 2px;
    }

    .cart-container {
      display: flex;
      gap: 30px;
      margin-top: 30px;
    }

    .cart-items {
      flex: 1;
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 5px 25px rgba(0, 0, 0, 0.05);
    }

    .cart-summary {
      width: 350px;
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 5px 25px rgba(0, 0, 0, 0.05);
      align-self: flex-start;
    }

    .cart-summary h2 {
      margin-bottom: 20px;
      font-size: 1.5rem;
      color: var(--text);
    }

    .cart-item {
      display: flex;
      padding: 20px;
      margin-bottom: 20px;
      background: var(--light);
      border-radius: 12px;
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .cart-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }

    .cart-item-image {
      width: 100px;
      height: 100px;
      margin-right: 20px;
      flex-shrink: 0;
    }

    .cart-item-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 8px;
    }

    .cart-item-details {
      flex: 1;
    }

    .cart-item-details h3 {
      font-size: 1.1rem;
      margin-bottom: 10px;
      color: var(--text);
    }

    .price {
      margin-bottom: 15px;
    }

    .current-price {
      font-weight: 600;
      font-size: 1.2rem;
      color: var(--primary);
    }

    .cart-item-actions {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .quantity-selector {
      display: flex;
      align-items: center;
      border: 1px solid #ddd;
      border-radius: 30px;
      overflow: hidden;
    }

    .quantity-btn {
      width: 35px;
      height: 35px;
      background: white;
      border: none;
      font-size: 1rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s;
    }

    .quantity-btn:hover {
      background: #f0f0f0;
    }

    .quantity-input {
      width: 50px;
      height: 35px;
      text-align: center;
      border: none;
      border-left: 1px solid #ddd;
      border-right: 1px solid #ddd;
      font-size: 1rem;
      appearance: textfield;
    }

    .quantity-input::-webkit-outer-spin-button,
    .quantity-input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .remove-btn {
      background: none;
      border: none;
      color: #e74c3c;
      cursor: pointer;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: color 0.3s;
    }

    .remove-btn:hover {
      color: #c0392b;
    }

    .summary-details {
      margin: 20px 0;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      font-size: 1rem;
    }

    .summary-row.total {
      font-weight: 700;
      font-size: 1.2rem;
      border-top: 1px solid #eee;
      padding-top: 15px;
      margin-top: 15px;
    }

    .btn {
      display: inline-block;
      padding: 12px 30px;
      border-radius: 30px;
      font-weight: 600;
      text-decoration: none;
      transition: all 0.3s;
      cursor: pointer;
      border: none;
      text-align: center;
    }

    .btn-primary {
      background: linear-gradient(45deg, var(--primary), var(--secondary));
      color: white;
      box-shadow: 0 10px 20px rgba(106, 17, 203, 0.3);
      width: 100%;
      margin-bottom: 15px;
    }

    .btn-primary:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 30px rgba(106, 17, 203, 0.4);
    }

    .continue-shopping {
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-light);
      gap: 5px;
      font-size: 0.9rem;
    }

    .empty-cart, .auth-message {
      text-align: center;
      padding: 50px 20px;
      background: white;
      border-radius: 15px;
      box-shadow: 0 5px 25px rgba(0, 0, 0, 0.05);
      max-width: 600px;
      margin: 0 auto;
    }

    .empty-cart i, .auth-message i {
      font-size: 50px;
      color: #ddd;
      margin-bottom: 20px;
    }

    .empty-cart h3, .auth-message h2 {
      font-size: 1.5rem;
      margin-bottom: 15px;
      color: var(--text);
    }

    .empty-cart p, .auth-message p {
      color: var(--text-light);
      margin-bottom: 25px;
      font-size: 1rem;
    }

    /* Футер */
    .footer {
      text-align: center;
      padding: 20px 0;
      color: var(--text-light);
      font-size: 0.9rem;
      background: white;
      box-shadow: 0 -2px 20px rgba(0, 0, 0, 0.03);
    }

    /* Адаптивность */
    @media (max-width: 768px) {
      .cart-container {
        flex-direction: column;
      }

      .cart-summary {
        width: 100%;
      }

      .cart-item {
        flex-direction: column;
      }

      .cart-item-image {
        width: 100%;
        height: auto;
        margin-right: 0;
        margin-bottom: 15px;
      }

      .cart-item-actions {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }

      .quantity-selector {
        width: 100%;
      }

      .remove-btn {
        width: 100%;
        justify-content: center;
        padding: 8px 0;
      }
    }

    @media (max-width: 480px) {
      .page-title {
        font-size: 1.5rem;
      }

      .cart-items, .cart-summary {
        padding: 15px;
      }

      .btn {
        padding: 10px 20px;
      }
    }
  </style>
</head>
<body>
  <!-- Остальная часть HTML остается без изменений -->
  <header class="header">
    <div class="container">
      <div class="logo">
        <a href="основная страница.html"><i class="fas fa-store"></i> Лисёнок<span>Маркет</span></a>
      </div>
      <div class="user-actions">
        <div class="user-menu">
          <a href="авторизация.html" id="user-link"><i class="fas fa-user"></i> Войти</a>
          <div class="user-dropdown" id="user-dropdown">
            <button id="logout-btn">Выйти</button>
          </div>
        </div>
        <a href="favorites.html"><i class="fas fa-heart"></i></a>
        <a href="cart.html"><i class="fas fa-shopping-cart"></i></a>
      </div>
    </div>
  </header>

  <main class="container cart-page">
    <h1 class="page-title">Ваша корзина</h1>
    
    <div id="cart-content">
      <!-- Контент корзины будет добавляться динамически -->
    </div>
    
    <div id="auth-message" style="display: none;">
      <div class="auth-message">
        <i class="fas fa-lock"></i>
        <h2>Требуется авторизация</h2>
        <p>Для просмотра корзины и оформления заказа необходимо войти в систему</p>
        <a href="авторизация.html" class="btn btn-primary">Войти или зарегистрироваться</a>
      </div>
    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <p>&copy; 2025 ЛисёнокМаркет. Все права лисят защищены.</p>
    </div>
  </footer>

  <!-- Скрипт остается без изменений -->
  <script>
    // Обновление количества товаров
    document.querySelectorAll('.quantity-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        const input = this.parentElement.querySelector('.quantity-input');
        let value = parseInt(input.value);
        
        if (this.classList.contains('minus') && value > 1) {
          input.value = value - 1;
        } else if (this.classList.contains('plus')) {
          input.value = value + 1;
        }
        
        // Здесь должна быть логика пересчета суммы
      });
    });
    
    // Удаление товаров
    document.querySelectorAll('.remove-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        this.closest('.cart-item').remove();
        // Здесь должна быть логика пересчета суммы
      });
    });
    
    // Авторизация
    const userLink = document.getElementById("user-link");
    const logoutBtn = document.getElementById("logout-btn");
    const userName = localStorage.getItem("userName");
    
    if (userName) {
      userLink.innerHTML = `<i class="fas fa-user"></i> ${userName}`;
      userLink.href = "account.html";
      if (logoutBtn) logoutBtn.style.display = "block";
    } else {
      userLink.innerHTML = `<i class="fas fa-user"></i> Войти`;
      userLink.href = "авторизация.html";
      if (logoutBtn) logoutBtn.style.display = "none";
    }
    
    if (logoutBtn) {
      logoutBtn.addEventListener("click", () => {
        localStorage.removeItem("userName");
        window.location.href = "/авторизация.html";
      });
    }
    // Функция для отображения корзины
    function renderCart() {
      const cartContent = document.getElementById('cart-content');
      const authMessage = document.getElementById('auth-message');
      
      if (!localStorage.getItem("userName")) {
        cartContent.style.display = 'none';
        authMessage.style.display = 'block';
        return;
      }
      
      authMessage.style.display = 'none';
      cartContent.style.display = 'block';
      
      // Получаем корзину из localStorage
      const cart = JSON.parse(localStorage.getItem("userCart")) || [];
      
      if (cart.length === 0) {
        cartContent.innerHTML = `
          <div class="empty-cart">
            <i class="fas fa-shopping-cart"></i>
            <h3>Ваша корзина пуста</h3>
            <p>Добавьте товары, чтобы продолжить покупки</p>
            <a href="основная страница.html" class="btn btn-primary">Перейти к товарам</a>
          </div>
        `;
        return;
      }
      
      // Формируем HTML для корзины
      let itemsHTML = '';
      let totalPrice = 0;
      
      cart.forEach(item => {
        // В реальном приложении здесь должны быть данные о товаре из базы
        // Для демо используем статические данные
        const product = {
          id: item.id,
          name: item.id === '1' ? 'Бобриная Хатка' : 'Норка для суриката',
          price: item.id === '1' ? 1699 : 1499,
          image: `https://via.placeholder.com/150x150?text=Товар ${item.id}`
        };
        
        const itemTotal = product.price * item.quantity;
        totalPrice += itemTotal;
        
        itemsHTML += `
          <div class="cart-item">
            <div class="cart-item-image">
              <img src="${product.image}" alt="${product.name}">
            </div>
            <div class="cart-item-details">
              <h3>${product.name}</h3>
              <div class="price">
                <span class="current-price">₽${product.price}</span>
              </div>
              <div class="cart-item-actions">
                <div class="quantity-selector">
                  <button class="quantity-btn minus">-</button>
                  <input type="number" value="${item.quantity}" min="1" class="quantity-input">
                  <button class="quantity-btn plus">+</button>
                </div>
                <button class="remove-btn" data-id="${item.id}"><i class="fas fa-trash-alt"></i> Удалить</button>
              </div>
            </div>
          </div>
        `;
      });
      
      const deliveryPrice = 490;
      const totalWithDelivery = totalPrice + deliveryPrice;
      
      cartContent.innerHTML = `
        <div class="cart-container">
          <div class="cart-items">
            ${itemsHTML}
          </div>
          
          <div class="cart-summary">
            <h2>Итого</h2>
            <div class="summary-details">
              <div class="summary-row">
                <span>Товары (${cart.reduce((sum, item) => sum + item.quantity, 0)} шт.)</span>
                <span>₽${totalPrice}</span>
              </div>
              <div class="summary-row">
                <span>Доставка</span>
                <span>₽${deliveryPrice}</span>
              </div>
              <div class="summary-row total">
                <span>Всего</span>
                <span>₽${totalWithDelivery}</span>
              </div>
            </div>
            <button class="btn btn-primary checkout-btn">Оформить заказ</button>
            <a href="основная страница.html" class="continue-shopping">
              <i class="fas fa-arrow-left"></i> Продолжить покупки
            </a>
          </div>
        </div>
      `;
      
      // Добавляем обработчики событий
      document.querySelectorAll('.remove-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const productId = this.getAttribute('data-id');
          removeFromCart(productId);
        });
      });
      
      document.querySelectorAll('.quantity-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const input = this.parentElement.querySelector('.quantity-input');
          let value = parseInt(input.value);
          
          if (this.classList.contains('minus') && value > 1) {
            input.value = value - 1;
          } else if (this.classList.contains('plus')) {
            input.value = value + 1;
          }
          
          updateCart();
        });
      });
      
      document.querySelectorAll('.quantity-input').forEach(input => {
        input.addEventListener('change', function() {
          if (this.value < 1) this.value = 1;
          updateCart();
        });
      });
    }
    
    // Функция обновления корзины
    function updateCart() {
      const cart = JSON.parse(localStorage.getItem("userCart")) || [];
      
      document.querySelectorAll('.cart-item').forEach(item => {
        const productId = item.querySelector('.remove-btn').getAttribute('data-id');
        const quantity = parseInt(item.querySelector('.quantity-input').value);
        
        const cartItem = cart.find(i => i.id === productId);
        if (cartItem) {
          cartItem.quantity = quantity;
        }
      });
      
      localStorage.setItem("userCart", JSON.stringify(cart));
      renderCart();
    }
    
    // Функция удаления из корзины
    function removeFromCart(productId) {
      let cart = JSON.parse(localStorage.getItem("userCart")) || [];
      cart = cart.filter(item => item.id !== productId);
      localStorage.setItem("userCart", JSON.stringify(cart));
      renderCart();
    }
    
    // При загрузке страницы отображаем корзину
    window.addEventListener('DOMContentLoaded', renderCart);

    // Функция для расчета общей суммы заказа
    function calculateOrderTotal() {
      const cart = JSON.parse(localStorage.getItem("userCart")) || [];
      let productsTotal = 0;
      let totalItems = 0;
      
      cart.forEach(item => {
        const productPrice = item.id === '1' ? 1699 : 1499;
        productsTotal += productPrice * item.quantity;
        totalItems += item.quantity;
      });
      
      const delivery = 490;
      const total = productsTotal + delivery;
      
      return {
        items: cart,
        productsTotal,
        delivery,
        total,
        totalItems
      };
    }

    // Обработчик кнопки "Оформить заказ"
    function setupCheckoutButton() {
      document.addEventListener('click', function(e) {
        if (e.target.classList.contains('checkout-btn')) {
          e.preventDefault();
          
          // Проверка авторизации
          if (!localStorage.getItem("userName")) {
            window.location.href = "авторизация.html";
            return;
          }
          
          // Проверка на пустую корзину
          const cart = JSON.parse(localStorage.getItem("userCart")) || [];
          if (cart.length === 0) {
            alert("Ваша корзина пуста!");
            return;
          }
          
          // Получаем данные корзины
          const orderData = calculateOrderTotal();
          
          // Сохраняем данные заказа в localStorage
          localStorage.setItem("currentOrder", JSON.stringify(orderData));
          
          // Перенаправляем на страницу оплаты
          window.location.href = "payment.html";
        }
      });
    }

    // При загрузке страницы
    window.addEventListener('DOMContentLoaded', function() {
      renderCart();
      setupCheckoutButton();
    });
  </script>
</body>
</html>